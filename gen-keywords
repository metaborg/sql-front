#!/bin/bash
# Execute in directory syntax or similar
# Finds all keywords in .sdf files by grabbing double quotes upper case words.
# Overwrites the file given as an argument to a simple sdf with lexical production ReservedKeyword and lexical restriction to get longest match.

if [ -z "$1" ]; then
	exit 1
else
	rm -f $1
	cat *.sdf */*.sdf > /tmp/gen-keywords.tmp
	echo -e "%%Autogenerated with ../../gen-keywords! (it's in the build file)\nmodule lexical/Keyword\nexports\n  sorts ReservedKeyword\n\n  lexical syntax" > $1
	grep -P '\"[A-Z]+\"|\"[a-z]+\"' -o /tmp/gen-keywords.tmp | sed 's/$/ -> ReservedKeyword/g' >> $1
	echo -e "\n  lexical restrictions" >> $1
	grep -P '\"[A-Z]+\"|\"[a-z]+\"' -o /tmp/gen-keywords.tmp | sed 's/$/ -\/- [a-zA-Z0-9\\\_\\\$]/g' >> $1
fi
